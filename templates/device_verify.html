<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SN 验证</title>
<script src="https://cdn.jsdelivr.net/npm/jssha/dist/sha256.min.js"></script>
<script>
    function submitForm(event) {
        event.preventDefault();

        const sn = document.getElementById('sn').value;
        const deviceid = document.getElementById('deviceid').value;
        const timestamp = Math.floor(Date.now() / 1000).toString();

        const shaObj = new jsSHA("SHA-256", "TEXT");
        shaObj.update(sn + timestamp);
        const sn_hash = shaObj.getHash("HEX");

        const url = `/device/deviceinfo?deviceid=${encodeURIComponent(deviceid)}&timestamp=${timestamp}&sn_hash=${sn_hash}`;
        window.location.href = url;
    }
</script>
</head>
<body>
    <h2>设备详细信息包含敏感内容，请机主本人验证 SN 序列号</h2>
    <p>验证设备 {{ deviceid }}</p>
    <p>设备别名 {{ devicename }}</p>

    <form onsubmit="submitForm(event)">
        <input type="hidden" id="deviceid" name="deviceid" value="{{ deviceid }}">
        <label for="sn">SN:</label>
        <input type="text" id="sn" name="sn" required>
        <button type="submit">验证并查看设备信息</button>
    </form>

    <p>验证成功后将返回设备 JSON 信息</p>
</body>
</html>