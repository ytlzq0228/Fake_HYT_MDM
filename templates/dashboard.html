<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Device Dashboard</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <h1>Registered Devices</h1>
    <div class="device-grid">
        {% for device_id, entry in devices.items() %}
        <div class="device-card">
            <h2>{{ entry.deviceInfo.wholeInfo.alias if entry.deviceInfo and entry.deviceInfo.wholeInfo else device_id }}</h2>
            <p><strong>Device ID:</strong> {{ device_id }}</p>
            <p><strong>Model:</strong> {{ entry.modelName or "N/A" }}</p>
            <p><strong>SN:</strong> {{ entry.sn or "N/A" }}</p>
            <p><strong>Version:</strong> {{ entry.versionCode or "N/A" }}</p>

            {% if entry.deviceInfo %}
                {% set bb = entry.deviceInfo.bbInfo %}
                {% set whole = entry.deviceInfo.wholeInfo %}

                <p><strong>Android:</strong> {{ bb.androidVersion }}</p>
                <p><strong>CPU:</strong> {{ bb.cpuModel }}</p>
                <p><strong>IP:</strong> {{ bb.ip }}</p>
                <p><strong>MAC:</strong> {{ bb.mac }}</p>

                <div class="bar-group">
                    <label>RAM Usage ({{ bb.ramUsage }} / {{ bb.ramTotal }} MB)</label>
                    <progress value="{{ bb.ramUsage }}" max="{{ bb.ramTotal }}"></progress>
                </div>

                <div class="bar-group">
                    <label>ROM Usage ({{ bb.romUsage }} / {{ bb.romTotal }} MB)</label>
                    <progress value="{{ bb.romUsage }}" max="{{ bb.romTotal }}"></progress>
                </div>

                <div class="bar-group">
                    <label>Battery Level ({{ whole.batteryLevel }}%)</label>
                    <progress value="{{ whole.batteryLevel }}" max="100"></progress>
                </div>

                <p><strong>VPN:</strong> {{ "Yes" if bb.vpn else "No" }}</p>
                <p><strong>Hotspot:</strong> {{ "Yes" if bb.personalHotSpot else "No" }}</p>
                <p><strong>Signal Level:</strong> {{ bb.signalLevel }} dBm</p>
            {% endif %}

            {% if entry.location %}
              <p>
                Location Time: {{ entry.location.update_time }}<br>
                Delay: {{ now - entry.location.update_time }} seconds<br>
                <a href="https://www.google.com/maps?q={{ entry.location.latitude }},{{ entry.location.longitude }}" target="_blank">
                  View on Google Maps
                </a>
              </p>
            {% endif %}
        </div>
        {% endfor %}
    </div>
</body>
</html>